<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>UFC GALO 7.2</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { position: relative; border: 8px solid #5d4037; background: #3e2723; }
        #login-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* O GALO */
        .rooster { position: absolute; width: 60px; height: 60px; transition: 0.05s linear; }
        .rooster-inner { width: 100%; height: 100%; position: relative; }
        .body { width: 40px; height: 45px; background: #eee; border-radius: 50%; position: absolute; bottom: 5px; left: 10px; }
        .color-preto .body { background: #222; }
        .color-vermelho .body { background: #b71c1c; }
        .beak { position: absolute; top: 20px; right: 2px; width: 12px; height: 8px; background: orange; border-radius: 0 50% 50% 0; }
        .comb { position: absolute; top: 5px; right: 15px; width: 15px; height: 12px; background: red; border-radius: 50% 50% 0 0; }
        .held-hammer { position: absolute; top: -10px; right: -15px; font-size: 30px; display: none; }
        .has-hammer .held-hammer { display: block; }

        /* ANIMAÃ‡ÃƒO DE ATAQUE DIRECIONAL */
        .attacking .rooster-inner { animation: peckAnim 0.05s ease-in-out; }
        @keyframes peckAnim {
            0% { transform: scaleX(1); }
            50% { transform: scaleX(1.3) translateX(10px); }
            100% { transform: scaleX(1); }
        }

        .hp-bar { position: absolute; top: -15px; width: 60px; height: 6px; background: #000; border: 1px solid #fff; }
        .hp-fill { height: 100%; background: #00ff00; width: 100%; transition: 0.1s; }
        .item-drop { position: absolute; font-size: 30px; }
        #leaderboard { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="login-screen">
        <h1>UFC GALO 7.2</h1>
        <input type="text" id="nick" placeholder="Seu apelido">
        <select id="color">
            <option value="branco">Branco</option>
            <option value="preto">Preto</option>
            <option value="vermelho">Vermelho</option>
        </select>
        <button onclick="enter()">ENTRAR</button>
    </div>

    <div id="game-container">
        <div id="leaderboard">TOP 5: <div id="lb-list"></div></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const arena = document.getElementById('game-container');
        let myId = null;

        function enter() {
            socket.emit('join_game', { name: document.getElementById('nick').value, color: document.getElementById('color').value });
            document.getElementById('login-screen').style.display = 'none';
        }

        socket.on('login_success', (data) => {
            myId = data.id;
            arena.style.width = data.width + 'px';
            arena.style.height = data.height + 'px';
            startKeys();
        });

        socket.on('update_state', (players) => {
            Object.values(players).forEach(p => {
                let el = document.getElementById(p.id);
                if (!el) {
                    el = document.createElement('div');
                    el.id = p.id;
                    el.className = `rooster color-${p.color}`;
                    el.innerHTML = `<div class="hp-bar"><div class="hp-fill"></div></div><div class="rooster-inner"><div class="comb"></div><div class="body"></div><div class="beak"></div><div class="held-hammer">ðŸ”¨</div></div>`;
                    arena.appendChild(el);
                }
                el.style.left = p.x + 'px';
                el.style.top = p.y + 'px';
                el.querySelector('.hp-fill').style.width = p.hp + '%';
                // Vira o galo para o lado certo
                el.style.transform = `scaleX(${p.direction})`;
                p.hasHammer ? el.classList.add('has-hammer') : el.classList.remove('has-hammer');
                if (p.dead) el.style.opacity = '0.3';
            });
        });

        socket.on('action_anim', (data) => {
            const el = document.getElementById(data.id);
            if (el) {
                el.classList.remove('attacking');
                void el.offsetWidth;
                el.classList.add('attacking');
            }
        });

        socket.on('hammer_spawn', (d) => spawnItem(d, 'ðŸ”¨'));
        socket.on('corn_spawn', (d) => spawnItem(d, 'ðŸŒ½'));
        socket.on('item_update', (d) => { if(d.status === 'picked') document.getElementById(d.id)?.remove(); });

        function spawnItem(d, icon) {
            const el = document.createElement('div');
            el.id = d.id; el.className = 'item-drop';
            el.innerText = icon; el.style.left = d.x + 'px'; el.style.top = d.y + 'px';
            arena.appendChild(el);
        }

        function startKeys() {
            const keys = {};
            window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
            window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;
            window.onmousedown = () => socket.emit('click_action');
            setInterval(() => {
                if(keys['w']) socket.emit('move', 'w');
                if(keys['s']) socket.emit('move', 's');
                if(keys['a']) socket.emit('move', 'a');
                if(keys['d']) socket.emit('move', 'd');
            }, 30);
        }
    </script>
</body>
</html>
