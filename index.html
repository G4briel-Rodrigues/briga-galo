<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>UFC GALO</title>
    <style>
        body { background: #222; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; overflow: hidden; }
        #game-container { 
            position: relative; 
            background: #d2b48c; /* Cor da lona bege */
            border: 15px solid #b71c1c; /* Cordas vermelhas */
            box-shadow: 0 0 50px black;
        }
        .ufc-logo {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 150px; color: rgba(0,0,0,0.05); font-weight: bold; pointer-events: none;
        }
        #login-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .rooster { position: absolute; width: 80px; height: 80px; transition: transform 0.1s; }
        .body { width: 50px; height: 60px; background: white; border-radius: 50%; position: absolute; top: 10px; }
        .color-preto .body { background: #333; }
        .color-vermelho .body { background: #a00; }
        .beak { position: absolute; right: -5px; top: 25px; width: 15px; height: 10px; background: orange; border-radius: 50%; }
        .hp-bar { position: absolute; top: -20px; width: 50px; height: 5px; background: red; }
        .hp-fill { height: 100%; background: lime; }
        .item-drop { position: absolute; font-size: 40px; z-index: 5; }
        .bullet { position: absolute; width: 8px; height: 8px; background: #333; border-radius: 50%; border: 1px solid white; }
        #announcement { position: absolute; top: 20px; width: 100%; text-align: center; color: yellow; font-size: 24px; font-weight: bold; text-shadow: 2px 2px black; }
        .held-item { position: absolute; top: 10px; right: -10px; font-size: 30px; display: none; }
        .has-hammer .held-hammer { display: block; }
        .has-gun .held-gun { display: block; }
        .dead { transform: rotate(90deg); opacity: 0.5; }
    </style>
</head>
<body>
    <div id="login-screen">
        <h1>ðŸ¥Š UFC GALO ðŸ¥Š</h1>
        <input type="text" id="nick" placeholder="Seu Nome">
        <select id="color">
            <option value="branco">Branco</option>
            <option value="preto">Preto</option>
            <option value="vermelho">Vermelho</option>
        </select>
        <button onclick="enter()">LUTAR</button>
    </div>

    <div id="game-container">
        <div class="ufc-logo">UFC</div>
        <div id="announcement"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const arena = document.getElementById('game-container');
        let myId = null;

        function enter() {
            const name = document.getElementById('nick').value || "Galo";
            const color = document.getElementById('color').value;
            socket.emit('join_game', { name, color });
            document.getElementById('login-screen').style.display = 'none';
        }

        socket.on('login_success', (data) => {
            myId = data.id;
            arena.style.width = data.width + 'px';
            arena.style.height = data.height + 'px';
        });

        socket.on('msg', (t) => { document.getElementById('announcement').innerText = t; });

        socket.on('update_items', (items) => {
            document.querySelectorAll('.item-drop').forEach(e => e.remove());
            if(items.hammer) createDrop(items.hammer, 'ðŸ”¨');
            if(items.gun) createDrop(items.gun, 'ðŸ”«');
            if(items.corn) createDrop(items.corn, 'ðŸŒ½');
        });

        function createDrop(item, icon) {
            const d = document.createElement('div');
            d.className = 'item-drop';
            d.innerText = icon;
            d.style.left = item.x + 'px'; d.style.top = item.y + 'px';
            arena.appendChild(d);
        }

        socket.on('update_bullets', (bullets) => {
            document.querySelectorAll('.bullet').forEach(e => e.remove());
            bullets.forEach(b => {
                const el = document.createElement('div'); el.className = 'bullet';
                el.style.left = b.x + 'px'; el.style.top = b.y + 'px';
                arena.appendChild(el);
            });
        });

        socket.on('update_state', (players) => {
            Object.values(players).forEach(p => {
                let el = document.getElementById(p.id);
                if(!el) {
                    el = document.createElement('div'); el.id = p.id; el.className = 'rooster color-'+p.color;
                    el.innerHTML = `<div class="hp-bar"><div class="hp-fill"></div></div>
                                    <div class="body"></div><div class="beak"></div>
                                    <div class="held-item held-hammer">ðŸ”¨</div>
                                    <div class="held-item held-gun">ðŸ”«</div>`;
                    arena.appendChild(el);
                }
                el.style.left = p.x + 'px'; el.style.top = p.y + 'px';
                el.style.transform = `scaleX(${p.direction})`;
                el.querySelector('.hp-fill').style.width = p.hp + '%';
                el.classList.toggle('has-hammer', p.hasHammer);
                el.classList.toggle('has-gun', p.hasGun);
                if(p.hp <= 0) el.classList.add('dead');
            });
        });

        window.onkeydown = (e) => socket.emit('move', e.key.toLowerCase());
        arena.onmousedown = (e) => {
            const rect = arena.getBoundingClientRect();
            socket.emit('click_action', { x: e.clientX - rect.left, y: e.clientY - rect.top });
        };
    </script>
</body>
</html>
